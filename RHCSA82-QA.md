## 重要配置信息

在考试期间，除了您就坐位置的台式机之外，还将使用多个虚拟系统。您不具有台式机系统的根访问权，但具有对虚拟系统的完全根访问权。

#### 系统信息

|             系统              |     IP 地址      |
| :---------------------------: | :--------------: |
| `node1.domain250.example.com` | `172.25.250.100` |
| `node2.domain250.example.com` | `172.25.250.200` |

您使用的系统属于 DNS 域 `domain250.example.com`。该域中的所有系统都位于 `172.25.250.0/255.255.255.0` 子网中，该子网中的所有系统都位于 `domain250.example.com` 中。

针对这些系统列出的 IP 地址是应该分配给系统的地址。您可能需要为一个或两个系统配置网络，以便能够通过上述地址访问您的地址。

#### 帐户信息

node1 的根密码已经设置为 `flectrag` 。

除非另有指定，否则这将是用于访问其他系统和服务的密码。此外，除非另有指定，否则应将该密码用于您创建的什么问题帐户或者需要设置密码的任意服务。

#### 其他信息

您可以通过 SSH 或控制台访问考试系统（参见下文所述）。请注意，SSH 访问权可能取决于您解答其他考试项目的情况。

如果您需要在系统上安装其他软件，可以使用位于以下地址的存储库：

- `http://foundation0.ilt.example.com/dvd/BaseOS`

- `http://foundation0.ilt.example.com/dvd/AppStream`

#### 注册服务器信息

注册服务器地址`registry.domain250.example.com`

使用 `admin` 作为用户名，使用 `redhat321` 作为映像注册表的凭据

#### 重要评测信息

您的系统会在重新引导后进行评测，因此务必确保您实施的的所有配置和服务在重新引导后仍然保留。服务必须在没有人工干预的情况下启动。

同样，本次考试使用的所有虚拟实例都必须 能够重新引导至适当的多用户目标，而无需任何人工辅助。<strong style="color: red">在无法引导或无法进行无人干预引导的系统上完成的所有操作都将为零分。</strong>




<h2>考试要求</h2>
在您的系统上执行以下所有步骤。

[toc]

## 在 node1.domain250.example.com 上执行以下任务。

#### ○ <font style="font-size:80%">复查</font> ○ <font style="font-size:80%">完成</font>		配置网络设置
> **将 node1 配置为具有以下网络配置：**
>
> - [ ] 主机名：`node1.domain250.example.com`
> - [ ] IP 地址：`172.25.250.100`
> - [ ] 子网掩码：`255.255.255.0`
> - [ ] 网关：`172.25.250.254`
> - [ ] DNS服务器：`172.25.250.254`

<div style="background: #dbfaf4; padding: 12px; line-height: 24px; margin-bottom: 24px;">
<dt style="background: #1abc9c; padding: 6px 12px; font-weight: bold; display: block; color: #fff; margin: -12px; margin-bottom: -12px; margin-bottom: 12px;" >Hint - 提示</dt>
  <li> 默认有生效的动态IP地址。配置完后，需要 <b>nmcli up</b> 生效
  <li> <b>search domains</b> 保持默认，不需修改
</div>


**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/vmware.png"> [foundation]**

<kbd>VM Control</kbd> /  `node1` / <kbd>OK</kbd> / `Console_node1_VM` / <kbd>OK</kbd>

```ini
clear login: root
Password: flectrag
```

**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/virt-viewer.png"> [node1]**

- 方法一

  ```bash
  # nmtui
      `Edit a connection` / `Wired connection 1` /
          IPv4 CONFIGURATION `Manual`
              Addresses `172.25.250.100/24`
              Gateway `172.25.250.254`
              DNS servers `172.25.250.254`
          <OK> / <Back> / `<Quit>`
  ```
  
  ![](https://gitee.com/suzhen99/redhat/raw/master/images/nmtui.png)
  ```bash
  # nmcli con up 'Wired connection 1'
  # ip a s
  ```
- 方法二

  ```bash
  # nmcli con show
  # man nmcli | grep nmcli.*mod
  
  # nmcli con mod 'Wired connection 1' \
  ipv4.method manual \
  ipv4.addresses 172.25.250.100/24 \
  ipv4.gateway 172.25.250.254 \
  ipv4.dns 172.25.250.254
  # nmcli con up 'Wired connection 1'
  # ip a s
  ```

**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/vmware.png"> [foundation]**

```bash
$ ssh root@node1
root@node1\'s password: `flectrag`
```

**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/virt-viewer.png">[node1]**

```bash
# hostnamectl set-hostname node1.domain250.example.com
```

```bash
# ip route
default via 172.25.250.254 dev eth0 proto static metric 100 
172.25.250.0/24 dev eth0 proto kernel scope link src 172.25.250.100 metric 100
# cat /etc/resolv.conf
# Generated by NetworkManager
search domain250.example.com
nameserver 172.25.250.254
# hostname
node1.domain250.example.com
# cat /etc/hostname
node1.domain250.example.com
```



#### ○ <font style="font-size:80%">复查</font> ○ <font style="font-size:80%">完成</font>		配置您的系统以使用默认存储库
> **配置您 的系统以使用默认存储库**
>
> - [ ] YUM 存储库已可以从 `http://foundation0.ilt.example.com/dvd/BaseOS` 和 `http://foundation0.ilt.example.com/dvd/AppStream` 使用配置您的系统，以将这些位置用作默认存储库

<div style="background: #dbfaf4; padding: 12px; line-height: 24px; margin-bottom: 24px;">
<dt style="background: #1abc9c; padding: 6px 12px; font-weight: bold; display: block; color: #fff; margin: -12px; margin-bottom: -12px; margin-bottom: 12px;" >Hint - 提示</dt>
  <li> foundation 浏览器中查找 <b>yum-utils</b> 包, dnf是yum的一个分支
  <li> <b>add-repo</b> 添多了，删除 <b>/etc/yum.repos.d</b> 目录下相关文件
</div>

**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/vmware.png"> [foundation]**

```bash
$ yum provides yum-config-manager
...
dnf-utils-4.0.2.2-3.el8.noarch : Yum-utils CLI compatibility layer
...
```

**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/virt-viewer.png"> [node1]**

```bash
# rpm -ivh http://foundation0.ilt.example.com/dvd/BaseOS/Packages/yum-utils-4.0.12-3.el8.noarch.rpm

# yum-config-manage -h | grep repo
# yum-config-manager --add-repo http://foundation0.ilt.example.com/dvd/BaseOS
Adding repo from: http://foundation0.ilt.example.com/dvd/BaseOS
# yum-config-manager --add-repo http://foundation0.ilt.example.com/dvd/AppStream
Adding repo from: http://foundation0.ilt.example.com/dvd/AppStream

# find / -name *KEY*
/etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-beta
/etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
/usr/share/doc/gnupg2/KEYSERVER
# rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
```

```bash
# yum -y install ftp
```



#### ○ <font style="font-size:80%">复查</font> ○ <font style="font-size:80%">完成</font>		调试 SELinux
> **调试 SELinux**
>
> 非标准端口 `82` 上运行的 Web 服务器在提供内容时遇到问题。根据需要调试并解决问题，使其满足以下条件：
>
> - [ ] 系统上的 Web 服务器能够提供 `/var/www/html` 中所有现有的 HTML 文件（注：不要删除或以其他方式改动现有的文件内容）
> - [ ] Web 服务器在端口 `82` 上提供此内容
> - [ ] Web 服务器在系统启动时`自动启动`

<div style="background: #dbfaf4; padding: 12px; line-height: 24px; margin-bottom: 24px;">
<dt style="background: #1abc9c; padding: 6px 12px; font-weight: bold; display: block; color: #fff; margin: -12px; margin-bottom: -12px; margin-bottom: 12px;" >Hint - 提示</dt>
  <li> 服务无法启动，查日志改端口
  <li> <b>file1</b> 无法访问；类型查看 <b>/var/www/html</b>
</div>

**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/virt-viewer.png"> [node1]**

```bash
# systemctl restart httpd

方法一、
# grep 82 /var/log/messages
...
*****  Plugin bind_ports (99.5 confidence) suggests   ************************
If you want to allow httpd to bind to network port 82
Then you need to modify the port type.
semanage port -a -t PORT_TYPE -p tcp 82
where PORT_TYPE is one of the following: http_cache_port_t, http_port_t, jboss_management_port_t, jboss_messaging_port_t, ntop_port_t, puppet_port_t.

方法二、
# man semanage port | grep \#
# semanage port -a -t http_port_t -p tcp 82

# systemctl restart httpd
# systemctl enable httpd

# ll /var/www/html/ -Z
-rw-r--r--. 1 root root system_u:object_r:etc_t:s0               14 Mar 24 08:12 file1
-rw-r--r--. 1 root root system_u:object_r:httpd_sys_content_t:s0 14 Mar 24 08:12 file2
-rw-r--r--. 1 root root system_u:object_r:httpd_sys_content_t:s0 14 Mar 24 08:12 file3

# man semanage fcontext | grep \#
# semanage fcontext -l | grep file1
/var/www/html/file1 all files system_u:object_r:etc_t:s0
# semanage fcontext -m -t httpd_sys_content_t "/var/www/html/file1"
# restorecon -v /var/www/html/file1
Relabeled /var/www/html/file1 from system_u:object_r:etc_t:s0 to system_u:object_r:httpd_sys_content_t:s0
```

```bash
# for i in {1..3}; do
  curl http://localhost:82/file$i
done
```



#### ○ <font style="font-size:80%">复查</font> ○ <font style="font-size:80%">完成</font>		创建用户帐户

> **创建用户帐户**
>
> 创建下列用户、组和组成员资格：
>
> - [ ] 名为 `sysmgrs` 的组
> - [ ] 用户 `natasha` ，作为次要组从属于 `sysmgrs`
> - [ ] 用户 `harry` ，作为次要组还从属于 `sysmgrs`
> - [ ] 用户 `sarah` ，无权访问系统上的`交互式 shell` 且不是 `sysmgrs` 的成员
> - [ ] `natasha` 、 `harry` 和 `sarah` 的密码应当都是 `flectrag`

<div style="background: #dbfaf4; padding: 12px; line-height: 24px; margin-bottom: 24px;">
<dt style="background: #1abc9c; padding: 6px 12px; font-weight: bold; display: block; color: #fff; margin: -12px; margin-bottom: -12px; margin-bottom: 12px;" >Hint - 提示</dt>
  <li> 非交互式的 shell 可以是 <b>/bin/false</b> 或 <b>/sbin/nologin</b>
</div>

**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/virt-viewer.png"> [node1]**

```bash
# groupadd sysmgrs
# useradd -G sysmgrs natasha
# useradd -G sysmgrs harry
# useradd -s /bin/false sarah
# for i in natasha harry sarah; do
echo flectrag | passwd --stdin $i
done
```

```bash
# ssh natasha@localhost id
# ssh harry@localhost id
# ssh sarah@localhost id
# grep sarah /etc/passwd
```



#### ○ <font style="font-size:80%">复查</font> ○ <font style="font-size:80%">完成</font>		配置 cron 作业
> **配置 cron 作业**
>
> 配置 `cron` 作业，该作业`每隔 2 分钟`运行并执行以下命令：
>
> - [ ] `logger "EX200 in progress"`，以用户 `natasha` 身份运行

<div style="background: #dbfaf4; padding: 12px; line-height: 24px; margin-bottom: 24px;">
<dt style="background: #1abc9c; padding: 6px 12px; font-weight: bold; display: block; color: #fff; margin: -12px; margin-bottom: -12px; margin-bottom: 12px;" >Hint - 提示</dt>
  <li> <b>crontab</b> 命令，或 <b>/etc/crontab</b> 文件两种方法皆可
  <li> 强烈建议使用命令这种做法
</div>

**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/virt-viewer.png"> [node1]**

```bash
# systemctl status crond
# crontab -e -u natasha
*/2 * * * *     logger "EX200 in progress"
```

```bash
# crontab -l -u natasha
*/2 * * * *     logger "EX200 in progress"

# grep EX200 /var/log/messages
Mar 24 09:32:01 node1 natasha[25113]: EX200 in progress
Mar 24 09:34:01 node1 natasha[25113]: EX200 in progress
```



#### ○ <font style="font-size:80%">复查</font> ○ <font style="font-size:80%">完成</font>		创建协作目录
> **创建具有以下特征的协作目录 `/home/managers` ：**
>
> - [ ] `/home/managers` 的组用权是 `sysmgrs`
> - [ ] 目录应当可被 `sysmgrs` 的成员读取、写入和访问，但任何其他用户不具这些权限。（当然，root 用户有权访问系统上的所有文件和目录）
> - [ ] `/home/managers` 中创建的文件自动将组所有权设置到 `sysmgrs` 组

<div style="background: #dbfaf4; padding: 12px; line-height: 24px; margin-bottom: 24px;">
<dt style="background: #1abc9c; padding: 6px 12px; font-weight: bold; display: block; color: #fff; margin: -12px; margin-bottom: -12px; margin-bottom: 12px;" >Hint - 提示</dt>
  <li> <b>字符法</b>或<b>数值法</b>都可以
  <li> suid=4, sgid=2, stick=1
</div>

**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/virt-viewer.png"> [node1]**

```bash
# mkdir /home/managers
# chown :sysmgrs /home/managers
# chmod g+rw,o=- /home/managers
# chmod g+s /home/managers/
```

```bash
# ls -ld /home/managers/
# touch /home/managers/file
# ll /home/managers/file
```



#### ○ <font style="font-size:80%">复查</font> ○ <font style="font-size:80%">完成</font>		配置 NTP
> **配置 NTP**
>
> 配置您的系统，使其成为 `materials.example.com` 的 NTP 客户端。（注：`materials.example.com` 是 `classroom.example.com` 的 DNS 别名）

<div style="background: #dbfaf4; padding: 12px; line-height: 24px; margin-bottom: 24px;">
<dt style="background: #1abc9c; padding: 6px 12px; font-weight: bold; display: block; color: #fff; margin: -12px; margin-bottom: -12px; margin-bottom: 12px;" >Hint - 提示</dt>
  <li> <b>chronyc sources -v</b> 命令验证时，显示的DNS名称可能不同。ping一下DNS名称，是同一台机器
</div>

<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/virt-viewer.png"> **[node1]**

```bash
# systemctl status chronyd
# vim /etc/chrony.conf
```
```ini
...
server materials.example.com iburst
```
```bash
# systemctl restart chronyd
```

```bash
# timedatectl
...
System clock synchronized: yes
              NTP service: active

# chronyc sources -v
210 Number of sources = 1

  .-- Source mode  '^' = server, '=' = peer, '#' = local clock.
 / .- Source state '*' = current synced, '+' = combined , '-' = not combined,
| /   '?' = unreachable, 'x' = time may be in error, '~' = time too variable.
||                                                 .- xxxx [ yyyy ] +/- zzzz
||      Reachability register (octal) -.           |  xxxx = adjusted offset,
||      Log2(Polling interval) --.      |          |  yyyy = measured offset,
||                                \     |          |  zzzz = estimated error.
||                                 |    |           \
MS Name/IP address         Stratum Poll Reach LastRx Last sample               
===============================================================================
^* classroom.example.com         8   6    17    17   -590us[ -844us] +/- 2547us
```



#### ○ <font style="font-size:80%">复查</font> ○ <font style="font-size:80%">完成</font>		配置 autofs
> **配置 autofs**
>
> 配置 `autofs` ，以按照如下所述自动挂载远程用户的主目录：
>
> - [ ] `materials.example.com` ( `172.25.254.254` ) NFS 导出 `/rhome` 到您的系统。此文件系统包含为用户 `remoteuser1` 预配置的主目录
> - [ ] `remoteuser1` 的主目录是 `materials.example.com:/rhome/remoteuser1`
> - [ ] `remoteuser1` 的主目录应自动挂载到本地 `/rhome` 下的 `/rhome/remoteuser1`
> - [ ] 主目录必须可供其用户`写入`
> - [ ] `remoteuser1` 的密码是 `flectrag`

<div style="background: #dbfaf4; padding: 12px; line-height: 24px; margin-bottom: 24px;">
<dt style="background: #1abc9c; padding: 6px 12px; font-weight: bold; display: block; color: #fff; margin: -12px; margin-bottom: -12px; margin-bottom: 12px;" >Hint - 提示</dt>
  <li> <b>/etc/auto.rhome</b> 需创建，拷贝的目的是为了参考格式
</div>
**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/virt-viewer.png"> [node1]**

```bash
# rpm -qc autofs

# vim /etc/auto.master
```
```ini
...
/rhome	/etc/auto.rhome
```
```bash
# cp /etc/auto.misc /etc/auto.rhome
# vim /etc/auto.rhome
```
```ini
remoteuser1	-rw	materials.example.com:/rhome/remoteuser1
```
```bash
# systemctl enable --now autofs
```

```bash
# ssh remoteuser1@localhost
remoteuser1@localhost\'s password: `flectrag`
$ pwd
/rhome/remoteuser1
$ touch my.file
$ mount | grep rhome
...
aterials.example.com:/rhome/remoteuser1 on /rhome/remoteuser1 type nfs4 (rw,relatime,vers=4.2,rsize=131072,wsize=131072,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=172.25.250.100,local_lock=none,addr=172.25.254.254)

$ <Ctrl+D>
```



#### ○ <font style="font-size:80%">复查</font> ○ <font style="font-size:80%">完成</font>		配置 /var/tmp/fstab 权限
> **配置 /var/tmp/fstab 权限**
>
> 将文件 `/etc/fstab` 复制到 `/var/tmp/fstab` 。配置 /var/tmp/fstab 的权限以满足如下条件：
>
> - [ ] 文件 `/var/tmp/fstab` 自 `root` 用户所有
> - [ ] 文件 `/var/tmp/fstab` 属于组 `root`
> - [ ] 文件 `/var/tmp/fstab` 应不能被任何人执行
> - [ ] 用户 `natasha` 能够读取和写入 `/var/tmp/fstab`
> - [ ] 用户 `harry` 无法写入或读取 `/var/tmp/fstab`
> - [ ] 所有其他用户（当前或未来）能够读取 `/var/tmp/fstab`

**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/virt-viewer.png"> [node1]**

```bash
# cp /etc/fstab /var/tmp/fstab

# man setfacl | grep \\-m
# setfacl -m u:natasha:rw /var/tmp/fstab
# setfacl -m u:harry:- /var/tmp/fstab
```

```bash
# ll /var/tmp/fstab
# getfacl /var/tmp/fstab
```



#### ○ <font style="font-size:80%">复查</font> ○ <font style="font-size:80%">完成</font>		配置用户帐户
> **配置用户帐号**
>
> 配置用户 `manalo` ，其用户 ID 为 `3533`。此用户的密码应当为 `flectrag`。

**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/virt-viewer.png"> [node1]**

```bash
# useradd -u 3533 manalo
# echo flectrag | passwd --stdin manalo
```

```bash
# ssh manalo@localhost id
```



#### ○ <font style="font-size:80%">复查</font> ○ <font style="font-size:80%">完成</font>		查找文件
> **查找文件**
>
> 查找当 `jacques` 所有的所有文件并将其副本放入 `/root/findfiles` 目录

<div style="background: #dbfaf4; padding: 12px; line-height: 24px; margin-bottom: 24px;">
<dt style="background: #1abc9c; padding: 6px 12px; font-weight: bold; display: block; color: #fff; margin: -12px; margin-bottom: -12px; margin-bottom: 12px;" >Hint - 提示</dt>
  <li> <b>创建文件夹</b> 是隐藏题
</div>

**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/virt-viewer.png"> [node1]**

```bash
# mkdir /root/findfiles

# man find | grep find.*exec
# find / -user jacques -exec cp -a {} /root/findfiles \;
```

```bash
# ll /root/findfiles/
total 0
-rw-r--r--. 1 jacques root    0 Mar 24 08:12 gamelan
-rw-r--r--. 1 jacques jacques 0 Mar 24 08:12 jacques
-rw-r--r--. 1 jacques root    0 Mar 24 08:12 libWedgeit.so.1.2.3
```



#### ○ <font style="font-size:80%">复查</font> ○ <font style="font-size:80%">完成</font>		查找字符串
> **查找字符串**
>
> 查找文件 `/usr/share/xml/iso-codes/iso_639_3.xml` 中包含字符串 `ng` 的所有行。将所有这些行的副本按原始顺序放在文件 `/root/list` 中。 `/root/list` 不得包含空行，且所有行必须是 `/usr/share/xml/iso-codes/iso_639_3.xml` 中原始行的确切副本。

**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/virt-viewer.png"> [node1]**

```bash
# grep ng /usr/share/xml/iso-codes/iso_639_3.xml

# grep ng /usr/share/xml/iso-codes/iso_639_3.xml > /root/list
```

```bash
# cat /root/list
```



#### ○ <font style="font-size:80%">复查</font> ○ <font style="font-size:80%">完成</font>		创建存档
> **创建存档**
>
> 创建一个名为 `/root/backup.tar.gz` 的 tar 存档，其应包含 `/usr/local` 的 tar 存档，其应包含 `/usr/local` 的内容。该 tar 存档必须使用 `gzip` 进行压缩。

<div style="background: #dbfaf4; padding: 12px; line-height: 24px; margin-bottom: 24px;">
<dt style="background: #1abc9c; padding: 6px 12px; font-weight: bold; display: block; color: #fff; margin: -12px; margin-bottom: -12px; margin-bottom: 12px;" >Hint - 提示</dt>
  <li> <b>tar: Removing leading '/' from member names</b> 这是提示，不是报错
</div>

**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/virt-viewer.png"> [node1]**

```bash
# man tar | grep gzip
       -z, --gzip, --gunzip, --ungzip
              Filter the archive through gzip(1).
                     tar (child): trying gzip
                     and, when that failed, switched to gzip.
       bzip2(1), compress(1), gzip(1), ..
       
# man tar | grep tar.*.tar

# tar -czf /root/backup.tar.gz /usr/local
tar: Removing leading '/' from member names
```

```bash
# tar -tf /root/backup.tar.gz 

# file /root/backup.tar.gz
/root/backup.tar.gz: gzip compressed data, ...
```



#### ○ <font style="font-size:80%">复查</font> ○ <font style="font-size:80%">完成</font>		配置容器使其自动启动

> **配置容器使其自动启动**
>
> 利用注册服务器上的 `rsyslog` 镜像，创建一个名为  `logserver` 的容器
>
> - [ ] 面向 `wallah` 用户，配置一个 systemd 服务
> - [ ] 该服务命名为 `container-logserver` ，并在系统重启时自动启动，无需干预

<div style="background: #dbfaf4; padding: 12px; line-height: 24px; margin-bottom: 24px;">
<dt style="background: #1abc9c; padding: 6px 12px; font-weight: bold; display: block; color: #fff; margin: -12px; margin-bottom: -12px; margin-bottom: 12px;" >Hint - 提示</dt>
  <li> <b>建议</b> 和 A卷或B卷，两题一起做
</div>
<div style="background: #f0f0f0; padding: 12px; line-height: 24px; margin-bottom: 24px;">
<dt style="background: #ee0000; padding: 6px 12px; font-weight: bold; display: block; color: #fff; margin: -12px; margin-bottom: -12px; margin-bottom: 12px;" >Important - 重要</dt>
  podman 默认已经安装 1.9 版本。<br><br><b>!不要自己安装！不要自己安装！不要自己安装！</b><br><br>如果安装，版本更新成 1.6 将不支持开机自启
</div>



#### ○ <font style="font-size:80%">复查</font> ○ <font style="font-size:80%">完成</font>		为容器配置持久存储（A卷）

> **为容器配置持久存储**
>
> 通过以下方式扩展上一个任务的服务
>
> - [ ] 配置主机系统的 journald 日志以在系统重启后保留数据，并重新启动日志记录服务
> - [ ] 将主机 `/var/log/journal`目录下任何以 `*.journal` 的文件复制到 `/home/wallah/container_logfile` 中
> - [ ] 将服务配置为在启动时自动将   `/home/wallah/container_logfile` 挂载到容器中的 `/var/log/journal` 下

<div style="background: #dbfaf4; padding: 12px; line-height: 24px; margin-bottom: 24px;">
<dt style="background: #1abc9c; padding: 6px 12px; font-weight: bold; display: block; color: #fff; margin: -12px; margin-bottom: -12px; margin-bottom: 12px;" >Hint - 提示</dt>
  <li> <b>建议</b> 和上一题，两题一起做
</div>
<div style="background: #f0f0f0; padding: 12px; line-height: 24px; margin-bottom: 24px;">
<dt style="background: #ee0000; padding: 6px 12px; font-weight: bold; display: block; color: #fff; margin: -12px; margin-bottom: -12px; margin-bottom: 12px;" >Important - 重要</dt>
  podman 默认已经安装 1.9 版本。<br><br><b>!不要自己安装！不要自己安装！不要自己安装！</b><br><br>如果安装，版本更新成 1.6 将不支持开机自启<br><br>一定要 <b>ssh</b>
</div>



#### ○ <font style="font-size:80%">复查</font> ○ <font style="font-size:80%">完成</font>		在容器中执行命令（B卷-口述）

> **在容器中执行命令**
>
> - [ ] `podman exec logserver logger -p authpriv.info suibian`

**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/virt-viewer.png"> [node1]**

- **（A卷）- B卷不需要创建文件夹**
```bash
# ll -d /run/log/journal 
drwxr-sr-x. 3 root systemd-journal 60 Mar 24 17:56 /run/log/journal

# mkdir /var/log/journal
# chown root:systemd-journal /var/log/journal
# chmod 2755 /var/log/journal
# systemctl restart systemd-journald

# cp /var/log/journal/*/system.journal /home/walhalla/container_logfile/
# chown -R wallah ~wallah
# ll -Z /home/wallah/container_logfile/
```
**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/virt-viewer.png"> [node1]**

```bash
# ssh wallah@localhost
$ podman login registry.domain250.example.com
Username: `admin`
Password: `redhat321`
login Succeeded!

$ podman search registry.domain250.example.com/
INDEX         NAME                                         DESCRIPTION   STARS   OFFICIAL   AUTOMATED
example.com   registry.domain250.example.com/rhel8/rsyslog               0
...

$ podman run -d --name logserver \
-v /home/wallah/container_logfile:/var/log/journal:Z \
registry.domain250.example.com/rhel8/rsyslog
$ podman stop logserver

$ loginctl enable-linger
$ loginctl show-user wallah

$ MANWIDTH=160; man systemd.unit | grep config.*user
       ~/.config/systemd/user.control/*
       ~/.config/systemd/user/*
       │~/.config/systemd/user.control                    |...
       │$HOME/.config/systemd/user                        │...

$ mkdir -p ~/.config/systemd/user/
$ cd ~/.config/systemd/user/
$ podman generate systemd -n logserver -f
$ systemctl --user enable --now container-logserver
$ systemctl --user status container-logserver

$ podman exec logserver ls /var/log/journal
system.journal
user-1004.journal
```

- **（B卷）**

```bash
$ podman exec logserver logger -p authpriv.info suibian
```



#### ○ <font style="font-size:80%">复查</font> ○ <font style="font-size:80%">完成</font>		添加sudo免密操作（新增）

> **添加sudo免密操作**
>
> - [ ] 允许`sysmgrs`组成员sudo时不需要密码

**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/virt-viewer.png"> [node1]**

```bash
# visudo
```

```ini
...
# %wheel        ALL=(ALL)       NOPASSWD: ALL
%sysmgrs        ALL=(ALL)       NOPASSWD: ALL
```

```bash
# su - natasha
$ sudo tail /var/log/messages
```



#### ○ <font style="font-size:80%">复查</font> ○ <font style="font-size:80%">完成</font>		配置创建新用户的密码策略（新增）

> **配置创建新用户的密码策略**
>
> - [ ] 创建新用户时，默认密码策略为`20`天后，密码会过期

**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/virt-viewer.png"> [node1]**

```bash
# vim /etc/login.defs
```
```ini
...
PASS_MAX_DAYS   20
```
```bash
# useradd dog

# chage -l dog
Last password change			: Apr 29, 2021
Password expires					: May 19, 2021
Password inactive					: never
Account expires						: never
Minimum number of days between password change		: 0
Maximum number of days between password change		: 20
Number of days of warning before password expires	: 7
```



---

## 在 node2.domain250.example.com 上执行以下任务。

#### ○ <font style="font-size:80%">复查</font> ○ <font style="font-size:80%">完成</font>		设置 root 密码
> **设置 root 密码**
>
> 将 node2 的 root 密码设置为 `flectrag` 。您需要获得系统访问权限才能进行此操作。

<div style="background: #dbfaf4; padding: 12px; line-height: 24px; margin-bottom: 24px;">
<dt style="background: #1abc9c; padding: 6px 12px; font-weight: bold; display: block; color: #fff; margin: -12px; margin-bottom: -12px; margin-bottom: 12px;" >Hint - 提示</dt>
  <li> <b>consoleblank=0</b> 考试环境中是这个
</div>

**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/vmware.png"> [foundation]**

<kbd><img width=25 src="https://gitee.com/suzhen99/redhat/raw/master/images/computer.png">VM Control</kbd> /  `node2` / <kbd>OK</kbd> / `Console_node2_VM` / <kbd>OK</kbd>

<kbd>Send key</kbd>, <kbd>Ctrl+Alt+Del</kbd>

:computer_mouse: <kbd>Click</kbd>

<kbd>:arrow_up:</kbd>, <kbd>e</kbd>

```ini
linux...<Space>rd.break console=tty0
```

<kbd>Ctrl</kbd>+<kbd>X</kbd>

```bash
# mount | grep sysroot
# mount -o remount,rw /sysroot
# mount | grep sysroot

# chroot /sysroot
# echo flectrag | passwd --stdin root
# touch /.autorelabel
# sync
```

<kbd>Ctrl</kbd>+<kbd>D</kbd>, <kbd>Ctrl</kbd>+<kbd>D</kbd>

```ini
node2 login: root
Password: flectrag
```



#### ○ <font style="font-size:80%">复查</font> ○ <font style="font-size:80%">完成</font>		配置您的系统以使用默认存储库
> **配置您 的系统以使用默认存储库**
>
> - [ ] YUM 存储库已可以从 `http://foundation0.ilt.example.com/dvd/BaseOS` 和 `http://foundation0.ilt.example.com/dvd/AppStream` 使用配置您的系统，以将这些位置用作默认存储库

<div style="background: #dbfaf4; padding: 12px; line-height: 24px; margin-bottom: 24px;">
<dt style="background: #1abc9c; padding: 6px 12px; font-weight: bold; display: block; color: #fff; margin: -12px; margin-bottom: -12px; margin-bottom: 12px;" >Hint - 提示</dt>
  <li> <b>repo</b> 文件可以远程拷贝，也可以重新创建
</div>

**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/virt-viewer.png"> [node2]**

```bash
# scp root@node1:/etc/yum.repos.d/*.repo /etc/yum.repos.d/
Are you sure you want to continue connecting (yes/no)? `yes`
Warning: Permanently added 'node1,172.25.250.100' (ECDSA) to the list of known hosts.
root@node1\'s password: `flectrag`

# vim /etc/yum.conf
```
```ini
...
gpgcheck=0
```
```bash
# yum -y install vdo
```



#### ○ <font style="font-size:80%">复查</font> ○ <font style="font-size:80%">完成</font>		调整逻辑卷大小
> **设置逻辑卷大小**
>
> 将逻辑卷 `vo` 及其文件系统的大小调整到 `230` MiB。确保文件系统内容保持不变。注：分区大小很少与请求的大小完全相同，因此可以接受范围为 `217` MiB 到 `243` MiB 的大小。

<div style="background: #dbfaf4; padding: 12px; line-height: 24px; margin-bottom: 24px;">
<dt style="background: #1abc9c; padding: 6px 12px; font-weight: bold; display: block; color: #fff; margin: -12px; margin-bottom: -12px; margin-bottom: 12px;" >Hint - 提示</dt>
  <li> <b>-l</b> --extents Number，PE 个数；<b>-L</b> --size Size，容量
  <li> <b>ext4</b> 使用 <b>resize2fs</b> 立即生效； <b>xfs</b> 使用 <b>xfs_growfs</b> 立即生效
</div>

**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/virt-viewer.png"> [node2]**

```bash
# df -h
# vgs myvol
# blkid /dev/myvol/vo
# lvextend -L 230M /dev/myvol/vo
# resize2fs /dev/myvol/vo
```

```bash
# df -h /reports/
```



#### ○ <font style="font-size:80%">复查</font> ○ <font style="font-size:80%">完成</font>		添加交换分区
> **添加交换分区**
>
> 向您的系统添加一个额外的交换分区 `756MiB` 。交换分区应在系统`启动时自动挂载`。不要删除或以任何方式改动系统上的任何现有交换分区。

<div style="background: #dbfaf4; padding: 12px; line-height: 24px; margin-bottom: 24px;">
<dt style="background: #1abc9c; padding: 6px 12px; font-weight: bold; display: block; color: #fff; margin: -12px; margin-bottom: -12px; margin-bottom: 12px;" >Hint - 提示</dt>
  <li> <b>fstab</b> 文件中注意没有挂载点，第二列写 <b>none</b> 或 <b>swap</b>
</div>

**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/virt-viewer.png"> [node2]**

```bash
# lsblk 
# fdisk /dev/vdb
Command (m for help): `n`
Partition type
   p   primary (2 primary, 0 extended, 2 free)
   e   extended (container for logical partitions)
Select (default p): `<Enter>`
...
Partition number (3,4, default 3): `<Enter>`
First sector (2095106-8388607, default 2097152): `<Enter>`
Last sector, +sectors or +size{K,M,G,T,P} (2097152-8388607, default 8388607): `+756M`
...
Command (m for help): `w`
...
# mkswap /dev/vdb3
# vim /etc/fstab
...
/dev/vdb3       swap    swap    defaults 0 0
# swapon -a
```

```bash
# swapon
```



#### ○ <font style="font-size:80%">复查</font> ○ <font style="font-size:80%">完成</font>		创建逻辑卷
> **创建逻辑卷**
>
> 根据如下要求，创建新的逻辑卷：
>
> - [ ] 逻辑卷取名为 `qa` ，属于 `qagroup` 卷组，大小为 `60` 个扩展块
> - [ ] `qagroup` 卷组中逻辑卷的扩展块大小应当为 `16 MiB`
> - [ ] 使用 `ext3` 文件系统格式化新逻辑卷。该逻辑卷应在系统启动时自动挂载到 `/mnt/qa` 下

**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/virt-viewer.png"> [node2]**

```bash
# lsblk
# fdisk /dev/vdb
Command (m for help): `n`
...
Partition type
   p   primary (3 primary, 0 extended, 1 free)
   e   extended (container for logical partitions)
Select (default e): `p`
Selected partition 4
First sector (2095106-8388607, default 3645440): `<Enter>`
Last sector, +sectors or +size{K,M,G,T,P} (3645440-8388607, default 8388607): `<Enter>`
...
Command (m for help): `w`
...
```
<div style="background: #dbfaf4; padding: 12px; line-height: 24px; margin-bottom: 24px;">
<dt style="background: #1abc9c; padding: 6px 12px; font-weight: bold; display: block; color: #fff; margin: -12px; margin-bottom: -12px; margin-bottom: 12px;" >Hint - 提示</dt>
  <li> 如果分区表未生效，<b>reboot</b> 重启
</div>

```bash
# pvcreate /dev/vdb4
# vgcreate -s 16M qagroup /dev/vdb4
# lvcreate -l 60 -n qa qagroup
# mkfs.ext3 /dev/qagroup/qa
# mkdir /mnt/qa
# vim /etc/fstab
```
```ini
...
/dev/qagroup/qa /mnt/qa ext3    defaults 1 2
```
```bash
# mount -a
```

```bash
# df
```



#### ○ <font style="font-size:80%">复查</font> ○ <font style="font-size:80%">完成</font>		创建 VDO 卷
> **创建 VDO 卷**
>
> 根据如下要求，创建新的 `VDO` 卷：
>
> - [ ] 使用未分区的磁盘
> - [ ] 该卷的名称为 `vdough`
> - [ ] 该卷的逻辑大小为 `50G`
> - [ ] 该卷使用 `xfs` 文件系统格式化
> - [ ] 该卷（在系统启动时）挂载到 `/vbread` 下

<div style="background: #dbfaf4; padding: 12px; line-height: 24px; margin-bottom: 24px;">
<dt style="background: #1abc9c; padding: 6px 12px; font-weight: bold; display: block; color: #fff; margin: -12px; margin-bottom: -12px; margin-bottom: 12px;" >Hint - 提示</dt>
  <li> mkfs.xfs <b>-K</b> 就是格式化速度快，容量小没差几秒
  <li> <b>udevadm settle</b> 注册，这步不做也能成功
</div>
<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/virt-viewer.png"> **[node2]**

```bash
# lsblk 

# man vdo | grep vdo.*create
# vdo create --name=vdough --device=/dev/vdc --vdoLogicalSize=50G
...
VDO instance 0 volume is ready at `/dev/mapper/vdough`

# mkfs.xfs -K /dev/mapper/vdough

# udevadm settle 

# mkdir /vbread

# vim /etc/fstab 
```
```ini
...
/dev/mapper/vdough      /vbread xfs     _netdev 1 2
```
```bash
# mount -a
```

```bash
# df -h /vbread
Filesystem          Size  Used Avail Use% Mounted on
/dev/mapper/vdough   50G  390M   50G   1% /vbread
```



#### ○ <font style="font-size:80%">复查</font> ○ <font style="font-size:80%">完成</font>		配置系统调优
> **配置系统调优**
>
> 为您的系统选择建议的 `tuned` 配置集并将它设为默认设置。

**<img width=35 src="https://gitee.com/suzhen99/redhat/raw/master/images/virt-viewer.png"> [node2]**

```bash
# tuned-adm active 
Current active profile: throughput-performance

# tuned-adm recommend
virtual-guest
# tuned-adm profile virtual-guest
```

```bash
# tuned-adm active
Current active profile: virtual-guest
```